// Generated by CoffeeScript 1.10.0
var log;

log = require('printit')({
  prefix: 'init'
});

module.exports = function(app, server, callback) {
  var feed, init;
  feed = require('./lib/feed');
  feed.initialize(server);
  init = require('./lib/init');
  return init.removeDocWithoutDocType(function(err) {
    if (err != null) {
      log.error(err);
    }
    return init.removeLostBinaries(function(err) {
      if (err != null) {
        log.error(err);
      }
      init.addThumbs(function(err) {
        if (err != null) {
          log.error(err);
        }
        return init.addAccesses(function(err) {
          if (err != null) {
            return log.error(err);
          }

          /*
          if process.env.USE_PLUGDB
              #plugdb
              init.initPlugDB (err) ->
                  log.error err if err?
                  #sharing rules
                  init.addSharingRules (err) ->
                      log.error err if err?
                      init.insertSharesPlugDB (err) ->
                          log.error err if err?
           */
        });
      });
      if (callback != null) {
        return callback(app, server);
      }
    });
  });
};
