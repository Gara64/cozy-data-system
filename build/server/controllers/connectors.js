// Generated by CoffeeScript 1.7.1
var Client, checkPermissions, client;

Client = require("request-json").JsonClient;

checkPermissions = require('../lib/token').checkDocType;

if (process.env.NODE_ENV === "test") {
  client = new Client("http://localhost:9092/");
} else {
  client = new Client("http://localhost:9102/");
}

module.exports.bank = function(req, res) {
  var path;
  if ((req.body.login != null) && (req.body.password != null)) {
    path = "connectors/bank/" + req.params.name + "/";
    return client.post(path, req.body, function(err, response, body) {
      if (err != null) {
        return res.send(500, {
          error: err
        });
      } else if (response == null) {
        return res.send(500, {
          error: "Response not found"
        });
      } else if (response.statusCode !== 200) {
        return res.send(response.statusCode, body);
      } else {
        return res.send(200, body);
      }
    });
  } else {
    return res.send(400, {
      error: "Credentials are not sent."
    });
  }
};

module.exports.bankHistory = function(req, res) {
  var path;
  if ((req.body.login != null) && (req.body.password != null)) {
    path = "connectors/bank/" + req.params.name + "/history/";
    return client.post(path, req.body, function(err, response, body) {
      if (err != null) {
        return res.send(500, {
          error: err
        });
      } else if (response == null) {
        return res.send(500, {
          error: "Res not found"
        });
      } else if (response.statusCode !== 200) {
        return res.send(response.statusCode, body);
      } else {
        return res.send(200, body);
      }
    });
  } else {
    return res.send(400, {
      error: "Credentials are not sent."
    });
  }
};
